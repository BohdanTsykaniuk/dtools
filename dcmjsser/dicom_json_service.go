package main

import "io/ioutil"
import "net/http"
import "strconv"
import "log"
import "encoding/json"
import "errors"
import "time"
import "os"

import "encoding/base64"

const htmlData = "PCFkb2N0eXBlIGh0bWw+DQo8aHRtbD4NCg0KPGhlYWQ+DQoJPHRpdGxlPmR0b29scyBVSTwvdGl0bGU+DQoJPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCI+DQoJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL25ldGRuYS5ib290c3RyYXBjZG4uY29tL2Jvb3Rzd2F0Y2gvMy4wLjAvc2xhdGUvYm9vdHN0cmFwLm1pbi5jc3MiPg0KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Imh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzIuMC4zL2pxdWVyeS5taW4uanMiPjwvc2NyaXB0Pg0KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Imh0dHBzOi8vbmV0ZG5hLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMS4xL2pzL2Jvb3RzdHJhcC5taW4uanMiPjwvc2NyaXB0Pg0KCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJCWJvZHkgew0KCQkJcGFkZGluZy10b3A6IDIwcHg7DQoJCX0NCgkJLmZvb3RlciB7DQoJCQlib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTsNCgkJCW1hcmdpbi10b3A6IDQwcHg7DQoJCQlwYWRkaW5nLXRvcDogNDBweDsNCgkJCXBhZGRpbmctYm90dG9tOiA0MHB4Ow0KCQl9DQoJCS8qIE1haW4gbWFya2V0aW5nIG1lc3NhZ2UgYW5kIHNpZ24gdXAgYnV0dG9uICovDQoJCQ0KCQkuanVtYm90cm9uIHsNCgkJCXRleHQtYWxpZ246IGNlbnRlcjsNCgkJCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KCQl9DQoJCS5qdW1ib3Ryb24gLmJ0biB7DQoJCQlmb250LXNpemU6IDIxcHg7DQoJCQlwYWRkaW5nOiAxNHB4IDI0cHg7DQoJCX0NCgkJLyogQ3VzdG9taXplIHRoZSBuYXYtanVzdGlmaWVkIGxpbmtzIHRvIGJlIGZpbGwgdGhlIGVudGlyZSBzcGFjZSBvZiB0aGUgLm5hdmJhciAqLw0KCQkNCgkJLm5hdi1qdXN0aWZpZWQgew0KCQkJYmFja2dyb3VuZC1jb2xvcjogI2VlZTsNCgkJCWJvcmRlci1yYWRpdXM6IDVweDsNCgkJCWJvcmRlcjogMXB4IHNvbGlkICNjY2M7DQoJCX0NCgkJLm5hdi1qdXN0aWZpZWQgPiBsaSA+IGEgew0KCQkJcGFkZGluZy10b3A6IDE1cHg7DQoJCQlwYWRkaW5nLWJvdHRvbTogMTVweDsNCgkJCWNvbG9yOiAjNzc3Ow0KCQkJZm9udC13ZWlnaHQ6IGJvbGQ7DQoJCQl0ZXh0LWFsaWduOiBjZW50ZXI7DQoJCQlib3JkZXItYm90dG9tOiAxcHggc29saWQgI2Q1ZDVkNTsNCgkJCWJhY2tncm91bmQtY29sb3I6ICNlNWU1ZTU7DQoJCQkvKiBPbGQgYnJvd3NlcnMgKi8NCgkJCQ0KCQkJYmFja2dyb3VuZC1yZXBlYXQ6IHJlcGVhdC14Ow0KCQkJLyogUmVwZWF0IHRoZSBncmFkaWVudCAqLw0KCQkJDQoJCQliYWNrZ3JvdW5kLWltYWdlOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQoJCQkvKiBGRjMuNisgKi8NCgkJCQ0KCQkJYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgY29sb3Itc3RvcCgwJSwgI2Y1ZjVmNSksIGNvbG9yLXN0b3AoMTAwJSwgI2U1ZTVlNSkpOw0KCQkJLyogQ2hyb21lLFNhZmFyaTQrICovDQoJCQkNCgkJCWJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgI2Y1ZjVmNSAwJSwgI2U1ZTVlNSAxMDAlKTsNCgkJCS8qIENocm9tZSAxMCssU2FmYXJpIDUuMSsgKi8NCgkJCQ0KCQkJYmFja2dyb3VuZC1pbWFnZTogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICNmNWY1ZjUgMCUsICNlNWU1ZTUgMTAwJSk7DQoJCQkvKiBJRTEwKyAqLw0KCQkJDQoJCQliYWNrZ3JvdW5kLWltYWdlOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAjZjVmNWY1IDAlLCAjZTVlNWU1IDEwMCUpOw0KCQkJLyogT3BlcmEgMTEuMTArICovDQoJCQkNCgkJCWZpbHRlcjogcHJvZ2lkOiBEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yc3RyPScjZjVmNWY1JywgZW5kQ29sb3JzdHI9JyNlNWU1ZTUnLCBHcmFkaWVudFR5cGU9MCk7DQoJCQkvKiBJRTYtOSAqLw0KCQkJDQoJCQliYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQodG9wLCAjZjVmNWY1IDAlLCAjZTVlNWU1IDEwMCUpOw0KCQkJLyogVzNDICovDQoJCX0NCgkJLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYSwNCgkJLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpob3ZlciwNCgkJLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpmb2N1cyB7DQoJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZGRkOw0KCQkJYmFja2dyb3VuZC1pbWFnZTogbm9uZTsNCgkJCWJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDdweCByZ2JhKDAsIDAsIDAsIC4xNSk7DQoJCX0NCgkJLm5hdi1qdXN0aWZpZWQgPiBsaTpmaXJzdC1jaGlsZCA+IGEgew0KCQkJYm9yZGVyLXJhZGl1czogNXB4IDVweCAwIDA7DQoJCX0NCgkJLm5hdi1qdXN0aWZpZWQgPiBsaTpsYXN0LWNoaWxkID4gYSB7DQoJCQlib3JkZXItYm90dG9tOiAwOw0KCQkJYm9yZGVyLXJhZGl1czogMCAwIDVweCA1cHg7DQoJCX0NCgkJQG1lZGlhKG1pbi13aWR0aDogNzY4cHgpIHsNCgkJCS5uYXYtanVzdGlmaWVkIHsNCgkJCQltYXgtaGVpZ2h0OiA1MnB4Ow0KCQkJfQ0KCQkJLm5hdi1qdXN0aWZpZWQgPiBsaSA+IGEgew0KCQkJCWJvcmRlci1sZWZ0OiAxcHggc29saWQgI2ZmZjsNCgkJCQlib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZDVkNWQ1Ow0KCQkJfQ0KCQkJLm5hdi1qdXN0aWZpZWQgPiBsaTpmaXJzdC1jaGlsZCA+IGEgew0KCQkJCWJvcmRlci1sZWZ0OiAwOw0KCQkJCWJvcmRlci1yYWRpdXM6IDVweCAwIDAgNXB4Ow0KCQkJfQ0KCQkJLm5hdi1qdXN0aWZpZWQgPiBsaTpsYXN0LWNoaWxkID4gYSB7DQoJCQkJYm9yZGVyLXJhZGl1czogMCA1cHggNXB4IDA7DQoJCQkJYm9yZGVyLXJpZ2h0OiAwOw0KCQkJfQ0KCQl9DQoJCS8qIFJlc3BvbnNpdmU6IFBvcnRyYWl0IHRhYmxldHMgYW5kIHVwICovDQoJCQ0KCQlAbWVkaWEgc2NyZWVuIGFuZChtaW4td2lkdGg6IDc2OHB4KSB7DQoJCQkvKiBSZW1vdmUgdGhlIHBhZGRpbmcgd2Ugc2V0IGVhcmxpZXIgKi8NCgkJCQ0KCQkJLm1hc3RoZWFkLA0KCQkJLm1hcmtldGluZywNCgkJCS5mb290ZXIgew0KCQkJCXBhZGRpbmctbGVmdDogMDsNCgkJCQlwYWRkaW5nLXJpZ2h0OiAwOw0KCQkJfQ0KCQl9DQoJPC9zdHlsZT4NCgk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCXZhciBjZlRpbWUgPSBuZXcgRGF0ZSgpOw0KCQl2YXIgY3VyZGlyID0gIiINCgkJdmFyIGRpc0FsaXZlID0gZmFsc2UNCgkJdmFyIFNob3dNZW51ID0gInNlYXJjaCINCgkJdmFyIGNVcGxvYWRGID0gIiINCg0KCQlmdW5jdGlvbiB1cGRhdGVDRWNob1N0KCkgew0KCQkJdmFyIGNFQ2hvUmVxID0gew0KCQkJCUFkZHJlc3M6ICQoIiNhZGRyZXNzLWlkIikudmFsKCksDQoJCQkJUG9ydDogJCgiI3BvcnQtaWQiKS52YWwoKSwNCgkJCQlTZXJ2ZXJBRV9UaXRsZTogJCgiI2FldGl0bGUtaWQiKS52YWwoKQ0KCQkJfTsNCgkJCSQuYWpheCh7DQoJCQkJdXJsOiAiL2MtZWNobyIsDQoJCQkJdHlwZTogIlBPU1QiLA0KCQkJCWRhdGE6IEpTT04uc3RyaW5naWZ5KGNFQ2hvUmVxKSwNCgkJCQlkYXRhVHlwZTogImpzb24iDQoJCQl9KS5kb25lKGZ1bmN0aW9uKGpzb25EYXRhKSB7DQoJCQkJY29uc29sZS5sb2coanNvbkRhdGEpDQoJCQkJZGlzQWxpdmUgPSBqc29uRGF0YS5Jc0FsaXZlDQoJCQkJdXBkYXRlVWkoKQ0KCQkJfSkNCgkJfQ0KDQoJCWZ1bmN0aW9uIHVwZGF0ZVVpKCkgew0KCQkJaWYgKGRpc0FsaXZlKSB7DQoJCQkJJCgiI3BhY3Mtc3RhdHVzLWlkIikudGV4dCgib2siKQ0KCQkJfSBlbHNlIHsNCgkJCQkkKCIjcGFjcy1zdGF0dXMtaWQiKS50ZXh0KCJubyBjb25uZWN0aW9uIikNCgkJCX0NCgkJCWlmIChkaXNBbGl2ZSAmJiAoU2hvd01lbnUgPT0gInNlYXJjaCIpKSB7DQoJCQkJJCgiI3NlYXJjaC1wYW5lbCIpLnNob3coKQ0KCQkJCSQoIiNzZWFyY2gtZm9vdGVyIikuc2hvdygpDQoJCQkJJCgiI3NlcmZvb3Rlci1pZCIpLnNob3coKQ0KCQkJCSQoIiNzZXJ0YWJsZS1pZCIpLnNob3coKQ0KCQkJfSBlbHNlIHsNCgkJCQkkKCIjc2VhcmNoLXBhbmVsIikuaGlkZSgpOw0KCQkJCSQoIiNzZWFyY2gtZm9vdGVyIikuaGlkZSgpDQoJCQkJJCgiI3NlcmZvb3Rlci1pZCIpLmhpZGUoKQ0KCQkJCSQoIiNzZXJ0YWJsZS1pZCIpLmhpZGUoKQ0KCQkJfQ0KCQkJaWYgKGRpc0FsaXZlICYmIChTaG93TWVudSA9PSAidXBsb2FkIikpIHsNCgkJCQkkKCIjZmlsZXMtdGFiIikuc2hvdygpDQoJCQkJJCgiI3VwbG9hZGZvb3Rlci1pZCIpLnNob3coKQ0KCQkJfSBlbHNlIHsNCgkJCQkkKCIjdXBsb2FkZm9vdGVyLWlkIikuaGlkZSgpDQoJCQkJJCgiI2ZpbGVzLXRhYiIpLmhpZGUoKQ0KCQkJfQ0KCQkJaWYgKGRpc0FsaXZlICYmIChTaG93TWVudSA9PSAiam9icyIpKSB7DQoJCQkJJCgiI2pvYnNsaXN0Zm9vdGVyLWlkIikuc2hvdygpDQoJCQkJJCgiI2pvYnNsaXN0Iikuc2hvdygpDQoJCQl9IGVsc2Ugew0KCQkJCSQoIiNqb2JzbGlzdGZvb3Rlci1pZCIpLmhpZGUoKQ0KCQkJCSQoIiNqb2JzbGlzdCIpLmhpZGUoKQ0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gc2VuZENGaW5kKCkgew0KCQkJdXBkYXRlSm9icygpDQoJCQl2YXIgY2ZkYXQgPSB7DQoJCQkJU2VydmVyU2V0OiB7DQoJCQkJCUFkZHJlc3M6ICQoIiNhZGRyZXNzLWlkIikudmFsKCksDQoJCQkJCVBvcnQ6ICQoIiNwb3J0LWlkIikudmFsKCksDQoJCQkJCVNlcnZlckFFX1RpdGxlOiAkKCIjYWV0aXRsZS1pZCIpLnZhbCgpDQoJCQkJfSwNCgkJCQlQYXRpZW50TmFtZTogJCgiI3BhdGllbnQtbmFtZS1pZCIpLnZhbCgpLA0KCQkJCUFjY2Vzc2lvbk51bWJlcjogJCgiI2FjY2Vzc2lvbi1udW1iZXItaWQiKS52YWwoKSwNCgkJCQlQYXRpZW5EYXRlT2ZCaXJ0aDogJCgiI2RhdGUtYmlydGgtaWQiKS52YWwoKSwNCgkJCQlTdHVkeURhdGU6ICQoIiNzdHVkeS1kYXRlLWlkIikudmFsKCkNCgkJCX07DQoJCQkkLmFqYXgoew0KCQkJCXVybDogIi9jLWZpbmQiLA0KCQkJCXR5cGU6ICJQT1NUIiwNCgkJCQlkYXRhOiBKU09OLnN0cmluZ2lmeShjZmRhdCksDQoJCQkJZGF0YVR5cGU6ICJqc29uIg0KCQkJfSkNCgkJfQ0KDQoJCWZ1bmN0aW9uIGNyZWF0ZVVVSUQoKSB7DQoJCQkvLyBodHRwOi8vd3d3LmlldGYub3JnL3JmYy9yZmM0MTIyLnR4dA0KCQkJdmFyIHMgPSBbXTsNCgkJCXZhciBoZXhEaWdpdHMgPSAiMDEyMzQ1Njc4OUFCQ0RFRiI7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IDMyOyBpKyspIHsNCgkJCQlzW2ldID0gaGV4RGlnaXRzLnN1YnN0cihNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAweDEwKSwgMSk7DQoJCQl9DQoJCQlzWzEyXSA9ICI0IjsgLy8gYml0cyAxMi0xNSBvZiB0aGUgdGltZV9oaV9hbmRfdmVyc2lvbiBmaWVsZCB0byAwMDEwDQoJCQlzWzE2XSA9IGhleERpZ2l0cy5zdWJzdHIoKHNbMTZdICYgMHgzKSB8IDB4OCwgMSk7IC8vIGJpdHMgNi03IG9mIHRoZSBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkIHRvIDAxDQoJCQl2YXIgdXVpZCA9IHMuam9pbigiIik7DQoJCQlyZXR1cm4gdXVpZDsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHVwZGF0ZUNGaW5kU3QoKSB7DQoJCQkkLmFqYXgoew0KCQkJCXVybDogIi9jLWZpbmRkYXQiLA0KCQkJCXR5cGU6ICJQT1NUIiwNCgkJCQlkYXRhOiBKU09OLnN0cmluZ2lmeShjZlRpbWUpLA0KCQkJCWRhdGFUeXBlOiAianNvbiINCgkJCX0pLmRvbmUoZnVuY3Rpb24oanNvbkRhdGEpIHsNCgkJCQlpZiAoanNvbkRhdGEuUmVmcmVzaCkgew0KCQkJCQljZlRpbWUgPSBqc29uRGF0YS5GVGltZQ0KCQkJCQkkKCIjc2VyY2hyZXNsaXN0IikucmVtb3ZlKCkNCgkJCQkJdmFyIGluZXJIdG1sID0gIiINCgkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0Ym9keSBpZD0ic2VyY2hyZXNsaXN0Ij4nKQ0KCQkJCQlmb3IgKGluZGV4IGluIGpzb25EYXRhLkNmaW5kUmVzKSB7DQoJCQkJCQlhbiA9IGpzb25EYXRhLkNmaW5kUmVzW2luZGV4XS5BY2Nlc3Npb25OdW1iZXINCgkJCQkJCXBkID0ganNvbkRhdGEuQ2ZpbmRSZXNbaW5kZXhdLlBhdGllbkRhdGVPZkJpcnRoDQoJCQkJCQlzZCA9IGpzb25EYXRhLkNmaW5kUmVzW2luZGV4XS5TdHVkeURhdGUNCgkJCQkJCXBuID0ganNvbkRhdGEuQ2ZpbmRSZXNbaW5kZXhdLlBhdGllbnROYW1lDQoJCQkJCQlndSA9IGNyZWF0ZVVVSUQoKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0cj4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0ZD48YSBpZD0iJyArIGd1ICsgJyIgb25jbGljaz0ic2VuZENHZXQodGhpcykiIGNsYXNzPSJidG4gcHVsbC1sZWZ0IGJ0bi1zdWNjZXNzIGJ0bi14cyI+RG93bmxvYWQ8L2E+PC90ZD4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0ZCBpZD0iJyArICdhbicgKyBndSArICciID4nICsgYW4gKyAnPC90ZD4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0ZCBpZD0iJyArICdwbicgKyBndSArICciID4nICsgcG4gKyAnPC90ZD4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0ZCBpZD0iJyArICdwZCcgKyBndSArICciID4nICsgcGQgKyAnPC90ZD4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzx0ZCBpZD0iJyArICdzZCcgKyBndSArICciID4nICsgc2QgKyAnPC90ZD4nKQ0KCQkJCQkJaW5lckh0bWwgPSBpbmVySHRtbC5jb25jYXQoJzwvdHI+JykNCgkJCQkJfQ0KCQkJCQlpbmVySHRtbCA9IGluZXJIdG1sLmNvbmNhdCgnIDwvdGJvZHk+JykNCgkJCQkJJCgiI3NlcnRhYmxlLWlkIikuYXBwZW5kKGluZXJIdG1sKQ0KCQkJCQljb25zb2xlLmxvZyhqc29uRGF0YS5DZmluZFJlcykNCgkJCQl9IGVsc2Ugew0KCQkJCQljb25zb2xlLmxvZygibm8gbmVlZCB0byB1cGRhdGUiKQ0KCQkJCX0NCgkJCX0pDQoJCX0NCg0KCQlmdW5jdGlvbiBjaERpcihlKSB7DQoJCQl2YXIgbkRpciA9IHsNCgkJCQlOZXc6IGUuaWQsDQoJCQkJQ3VyRGlyOiBjdXJkaXINCgkJCX07DQoJCQkkLmFqYXgoew0KCQkJCXVybDogIi9jaGQiLA0KCQkJCXR5cGU6ICJQT1NUIiwNCgkJCQlkYXRhVHlwZTogImpzb24iLA0KCQkJCWRhdGE6IEpTT04uc3RyaW5naWZ5KG5EaXIpDQoJCQl9KS5kb25lKGRpclVwZGF0ZSkNCgkJfQ0KDQoJCWZ1bmN0aW9uIGZpcnNVcGRhdGUoKSB7DQoJCQl2YXIgbkRpciA9IHsNCgkJCQlOZXc6ICIuIiwNCgkJCQlDdXJEaXI6ICIuIg0KCQkJfTsNCgkJCSQuYWpheCh7DQoJCQkJdXJsOiAiL2NoZCIsDQoJCQkJdHlwZTogIlBPU1QiLA0KCQkJCWRhdGFUeXBlOiAianNvbiIsDQoJCQkJZGF0YTogSlNPTi5zdHJpbmdpZnkobkRpcikNCgkJCX0pLmRvbmUoZGlyVXBkYXRlKQ0KCQl9DQoNCgkJZnVuY3Rpb24gZGlyVXBkYXRlKGpzb25EYXRhKSB7DQoJCQkkKCIjZmlsZXMtaWQiKS5yZW1vdmUoKQ0KCQkJY3VyZGlyID0ganNvbkRhdGEuQ3VyRGlyDQoJCQljb25zb2xlLmxvZyhqc29uRGF0YSkNCgkJCXZhciBpbmVySHRtbGZpbGVzID0gIiINCgkJCWluZXJIdG1sZmlsZXMgPSBpbmVySHRtbGZpbGVzLmNvbmNhdCgnPHRib2R5IGlkPSJmaWxlcy1pZCI+JykNCgkJCWluZXJIdG1sZmlsZXMgPSBpbmVySHRtbGZpbGVzLmNvbmNhdCgnPHRyPjx0ZD48L3RkPicpDQoJCQlpbmVySHRtbGZpbGVzID0gaW5lckh0bWxmaWxlcy5jb25jYXQoJzx0ZCBvbmNsaWNrPSJjaERpcih0aGlzKSIgaWQ9Ii4uIj48aW1nIHNyYz0iaHR0cDovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL2QvZGMvQmx1ZV9mb2xkZXJfc2V0aF95YXN0cm92XzAxLnN2ZyIgd2lkdGg9IjMwIiBhbHQ9ImxvcmVtIj4uLjwvdGQ+PC90cj4nKQ0KCQkJZm9yIChpbmRleCBpbiBqc29uRGF0YS5GaWxlcykgew0KCQkJCW5tID0ganNvbkRhdGEuRmlsZXNbaW5kZXhdLk5hbWUNCgkJCQlkaSA9IGpzb25EYXRhLkZpbGVzW2luZGV4XS5Jc0Rpcg0KCQkJCWlmIChqc29uRGF0YS5GaWxlc1tpbmRleF0uSXNEaXIpIHsNCgkJCQkJaW5lckh0bWxmaWxlcyA9IGluZXJIdG1sZmlsZXMuY29uY2F0KCc8dHIgd2lkdGg9IjUiPjx0ZD48YSAgb25jbGljaz0ic2VuZENTdG9yZSh0aGlzKSIgaWQ9IicgKyAnZmknICsgbm0gKyAnLyIgY2xhc3M9ImJ0biBwdWxsLWxlZnQgYnRuLXN1Y2Nlc3MgYnRuLXhzIj5VcGxvYWQ8L2E+PC90ZD4nKQ0KCQkJCQlpbmVySHRtbGZpbGVzID0gaW5lckh0bWxmaWxlcy5jb25jYXQoJzx0ZCBvbmNsaWNrPSJjaERpcih0aGlzKSIgJyArICdpZD0iJyArIG5tICsgJyI+PGltZyBzcmM9Imh0dHA6Ly91cGxvYWQud2lraW1lZGlhLm9yZy93aWtpcGVkaWEvY29tbW9ucy9kL2RjL0JsdWVfZm9sZGVyX3NldGhfeWFzdHJvdl8wMS5zdmciIHdpZHRoPSIzMCIgYWx0PSJsb3JlbSI+JyArIG5tICsgJzwvdGQ+PC90cj4nKQ0KCQkJCX0gZWxzZSB7DQoJCQkJCWluZXJIdG1sZmlsZXMgPSBpbmVySHRtbGZpbGVzLmNvbmNhdCgnPHRyIHdpZHRoPSI1Ij48dGQ+PGEgIG9uY2xpY2s9InNlbmRDU3RvcmUodGhpcykiIGlkPSInICsgJ2ZpJyArIG5tICsgJyIgY2xhc3M9ImJ0biBwdWxsLWxlZnQgYnRuLXN1Y2Nlc3MgYnRuLXhzIj5VcGxvYWQ8L2E+PC90ZD4nKQ0KCQkJCQlpbmVySHRtbGZpbGVzID0gaW5lckh0bWxmaWxlcy5jb25jYXQoJzx0ZCBvbmNsaWNrPSJjaERpcih0aGlzKSIgJyArICdpZD0iJyArIG5tICsgJyI+PGltZyBzcmM9Imh0dHA6Ly93d3cuZnJlZWNhZHdlYi5vcmcvd2lraS9pbWFnZXMvMi8yOS9Eb2N1bWVudC1uZXcuc3ZnIiB3aWR0aD0iMzAiIGFsdD0ibG9yZW0iPicgKyBubSArICc8L3RkPjwvdHI+JykNCgkJCQl9DQoJCQl9DQoJCQlpbmVySHRtbGZpbGVzID0gaW5lckh0bWxmaWxlcy5jb25jYXQoJzwvdGJvZHk+JykNCgkJCSQoIiNmaWxlcy10YWIiKS5hcHBlbmQoaW5lckh0bWxmaWxlcykNCgkJfQ0KDQoJCWZ1bmN0aW9uIHVwZGF0ZUpvYnMoKSB7DQoJCQkkKCIjam9ic2xpc3QiKS5odG1sKCIiKQ0KCQkJJC5hamF4KHsNCgkJCQl1cmw6ICIvam9icyIsDQoJCQkJdHlwZTogIlBPU1QiLA0KCQkJCWRhdGFUeXBlOiAianNvbiINCgkJCX0pLmRvbmUoZnVuY3Rpb24oanNvbkRhdGEpIHsNCgkJCQl2YXIgaW5lckh0bWxqb2JzID0gIiINCgkJCQlmb3IgKGluZGV4IGluIGpzb25EYXRhKSB7DQoJCQkJCWluZXJIdG1sam9icyA9IGluZXJIdG1sam9icy5jb25jYXQoJzxsaSBjbGFzcz0ibGlzdC1ncm91cC1pdGVtIj4nICsganNvbkRhdGFbaW5kZXhdICsgJzwvbGk+JykNCgkJCQl9DQoJCQkJJCgiI2pvYnNsaXN0IikuYXBwZW5kKGluZXJIdG1sam9icykNCgkJCX0pDQoJCX0NCg0KCQlmdW5jdGlvbiBzZW5kQ0dldChlKSB7DQoJCQlhbiA9ICQoIiNhbiIgKyBlLmlkKS50ZXh0KCkNCgkJCXBuID0gJCgiI3BuIiArIGUuaWQpLnRleHQoKQ0KCQkJcGQgPSAkKCIjcGQiICsgZS5pZCkudGV4dCgpDQoJCQlzZCA9ICQoIiNzZCIgKyBlLmlkKS50ZXh0KCkNCgkJCWNvbnNvbGUubG9nKGFuKQ0KCQkJY29uc29sZS5sb2cocG4pDQoJCQljb25zb2xlLmxvZyhwZCkNCgkJCWNvbnNvbGUubG9nKHNkKQ0KCQl9DQoNCgkJZnVuY3Rpb24gc2VuZENTdG9yZShlKSB7DQoJCQl2YXIgZnAgPSBjdXJkaXIgKyAnLycgKyBlLmlkLnN1YnN0cmluZygyKQ0KCQkJdmFyIGNzZGF0ID0gew0KCQkJCVNlcnZlclNldDogew0KCQkJCQlBZGRyZXNzOiAkKCIjYWRkcmVzcy1pZCIpLnZhbCgpLA0KCQkJCQlQb3J0OiAkKCIjcG9ydC1pZCIpLnZhbCgpLA0KCQkJCQlTZXJ2ZXJBRV9UaXRsZTogJCgiI2FldGl0bGUtaWQiKS52YWwoKQ0KCQkJCX0sDQoJCQkJRmlsZTogZnAsDQoJCQl9DQoJCQljb25zb2xlLmxvZyhjc2RhdCkNCgkJCSQuYWpheCh7DQoJCQkJdXJsOiAiL2MtY3RvcmUiLA0KCQkJCXR5cGU6ICJQT1NUIiwNCgkJCQlkYXRhOiBKU09OLnN0cmluZ2lmeShjc2RhdCksDQoJCQkJZGF0YVR5cGU6ICJqc29uIg0KCQkJfSkNCgkJfQ0KDQoJCWZ1bmN0aW9uIE9uTG9hZCgpIHsNCgkJCWNmVGltZSA9IDAuMDsNCgkJCXVwZGF0ZVVpKCkNCgkJCXVwZGF0ZUNFY2hvU3QoKQ0KCQkJc2V0SW50ZXJ2YWwodXBkYXRlQ0VjaG9TdCwgNzAwKQ0KCQkJc2V0SW50ZXJ2YWwodXBkYXRlQ0ZpbmRTdCwgNDAwKQ0KCQkJc2V0SW50ZXJ2YWwodXBkYXRlSm9icywgMjAwMCkNCgkJCWZpcnNVcGRhdGUoKQ0KCQl9DQoNCgkJZnVuY3Rpb24gU2hvd1NlYXJjaCgpIHsNCgkJCVNob3dNZW51ID0gInNlYXJjaCINCgkJCXVwZGF0ZVVpKCkNCgkJfQ0KDQoJCWZ1bmN0aW9uIFNob3dVcGxvYWQoKSB7DQoJCQlTaG93TWVudSA9ICJ1cGxvYWQiDQoJCQl1cGRhdGVVaSgpDQoJCX0NCg0KCQlmdW5jdGlvbiBTaG93Sm9icygpIHsNCgkJCVNob3dNZW51ID0gImpvYnMiDQoJCQl1cGRhdGVKb2JzKCkNCgkJCXVwZGF0ZVVpKCkNCgkJfQ0KCTwvc2NyaXB0Pg0KPC9oZWFkPg0KDQo8Ym9keSBvbmxvYWQ9Ik9uTG9hZCgpIj4NCgk8ZGl2IGNsYXNzPSJjb250YWluZXIiPg0KCQk8ZGl2IGNsYXNzPSJ3ZWxsIj4NCgkJCTxkaXYgY2xhc3M9Im5hdmJhciBuYXZiYXItZGVmYXVsdCI+DQoJCQkJPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCgkJCQkJPGRpdiBjbGFzcz0ibmF2YmFyLWhlYWRlciI+DQoJCQkJCQk8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9Im5hdmJhci10b2dnbGUiIGRhdGEtdG9nZ2xlPSJjb2xsYXBzZSIgZGF0YS10YXJnZXQ9Ii5uYXZiYXItY29sbGFwc2UiPiA8c3BhbiBjbGFzcz0ic3Itb25seSI+VG9nZ2xlIG5hdmlnYXRpb248L3NwYW4+PHNwYW4gY2xhc3M9Imljb24tYmFyIj48L3NwYW4+PHNwYW4gY2xhc3M9Imljb24tYmFyIj48L3NwYW4+PHNwYW4gY2xhc3M9Imljb24tYmFyIj48L3NwYW4+IDwvYnV0dG9uPg0KCQkJCQk8L2Rpdj4NCgkJCQkJPGRpdiBjbGFzcz0iY29sbGFwc2UgbmF2YmFyLWNvbGxhcHNlIj4NCgkJCQkJCTx1bCBjbGFzcz0ibmF2IG5hdmJhci1uYXYiPg0KCQkJCQkJCTxsaSBvbmNsaWNrPSJTaG93U2VhcmNoKCkiPiA8YT5TZWFyY2g8L2E+IDwvbGk+DQoJCQkJCQkJPGxpIG9uY2xpY2s9IlNob3dVcGxvYWQoKSI+IDxhPlN0dWR5IFVwbG9hZDwvYT4gPC9saT4NCgkJCQkJCQk8bGkgb25jbGljaz0iU2hvd0pvYnMoKSI+IDxhPkpvYnM8L2E+IDwvbGk+DQoJCQkJCQk8L3VsPg0KCQkJCQk8L2Rpdj4NCgkJCQk8L2Rpdj4NCgkJCTwvZGl2Pg0KCQkJPGRpdiBjbGFzcz0icGFuZWwtZm9vdGVyIj5ESUNPTSBTZXJ2ZXIgc2V0dGluZ3MgPC9kaXY+DQoJCQk8dGFibGUgY2xhc3M9InRhYmxlIHRhYmxlLWJvcmRlcmVkIHRhYmxlLWNvbmRlbnNlZCB0YWJsZS1ob3ZlciB0YWJsZS1zdHJpcGVkIj4NCgkJCQk8dGJvZHk+DQoJCQkJCTx0cj4NCgkJCQkJCTx0ZD4NCgkJCQkJCQk8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCgkJCQkJCQkJPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5ESUNPTSBzZXJ2ZXIgYWRkcmVzczwvbGFiZWw+DQoJCQkJCQkJCTxkaXYgY2xhc3M9ImNvbnRyb2xzIj4NCgkJCQkJCQkJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iYWRkcmVzcy1pZCIgdmFsdWU9IjIxMy4xNjUuOTQuMTU4Ij4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPkFFLVRpdGxlPC9sYWJlbD4NCgkJCQkJCQkJPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KCQkJCQkJCQkJPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJhZXRpdGxlLWlkIiB2YWx1ZT0iQUVfR0VQQUNTIj4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlBvcnQgbnVtYmVyPC9sYWJlbD4NCgkJCQkJCQkJPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KCQkJCQkJCQkJPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJwb3J0LWlkIiB2YWx1ZT0iMTA0Ij4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPkRJQ09NIHBpbmcgc3RhdHVzOjwvbGFiZWw+DQoJCQkJCQkJCTxwPg0KCQkJCQkJCQkJPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIiBpZD0icGFjcy1zdGF0dXMtaWQiPk9LPC9sYWJlbD4NCgkJCQkJCQkJPC9wPg0KCQkJCQkJCTwvZGl2Pg0KCQkJCQkJPC90ZD4NCgkJCQkJPC90cj4NCgkJCQk8L3Rib2R5Pg0KCQkJPC90YWJsZT4NCgkJCTxkaXYgY2xhc3M9InBhbmVsLWZvb3RlciIgaWQ9InNlYXJjaC1mb290ZXIiPlNlYXJjaCBTZXR0aW5ncyA8L2Rpdj4NCgkJCTx0YWJsZSBpZD0ic2VhcmNoLXBhbmVsIiBjbGFzcz0idGFibGUgdGFibGUtYm9yZGVyZWQgdGFibGUtY29uZGVuc2VkIHRhYmxlLWhvdmVyIHRhYmxlLXN0cmlwZWQiPg0KCQkJCTx0Ym9keT4NCgkJCQkJPHRyPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlBhdGllbnQgbmFtZTwvbGFiZWw+DQoJCQkJCQkJCTxkaXYgY2xhc3M9ImNvbnRyb2xzIj4NCgkJCQkJCQkJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0icGF0aWVudC1uYW1lLWlkIj4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPkFjY2Vzc2lvbiBudW1iZXI8L2xhYmVsPg0KCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250cm9scyI+DQoJCQkJCQkJCQk8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCBpbnB1dC1zbSIgaWQ9ImFjY2Vzc2lvbi1udW1iZXItaWQiPiA8L2Rpdj4NCgkJCQkJCQk8L2Rpdj4NCgkJCQkJCTwvdGQ+DQoJCQkJCQk8dGQ+DQoJCQkJCQkJPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQoJCQkJCQkJCTxsYWJlbCBjbGFzcz0iY29udHJvbC1sYWJlbCI+RGF0ZSBvZiBiaXJ0aDwvbGFiZWw+DQoJCQkJCQkJCTxkaXYgY2xhc3M9ImNvbnRyb2xzIj4NCgkJCQkJCQkJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZGF0ZS1iaXJ0aC1pZCI+IDwvZGl2Pg0KCQkJCQkJCTwvZGl2Pg0KCQkJCQkJPC90ZD4NCgkJCQkJCTx0ZD4NCgkJCQkJCQk8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCgkJCQkJCQkJPGxhYmVsIGNsYXNzPSJjb250cm9sLWxhYmVsIj5TdHVkeSBkYXRlPC9sYWJlbD4NCgkJCQkJCQkJPGRpdiBjbGFzcz0iY29udHJvbHMiPg0KCQkJCQkJCQkJPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJzdHVkeS1kYXRlLWlkIj4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCQkJCQkJCQk8bGFiZWwgY2xhc3M9ImNvbnRyb2wtbGFiZWwiPiA8L2xhYmVsPg0KCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250cm9scyI+IDxhIG9uY2xpY2s9InNlbmRDRmluZCgpIiBjbGFzcz0iYnRuIHB1bGwtbGVmdCBidG4taW5mbyI+RiBJIE4gRDwvYT4gPC9kaXY+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQk8L3RyPg0KCQkJCTwvdGJvZHk+DQoJCQk8L3RhYmxlPg0KCQkJPGRpdiBjbGFzcz0icGFuZWwtZm9vdGVyIiBpZD0ic2VyZm9vdGVyLWlkIj5DLUZpbmQgcmVzdWx0PC9kaXY+DQoJCQk8dGFibGUgY2xhc3M9InRhYmxlIHRhYmxlLWJvcmRlcmVkIHRhYmxlLWNvbmRlbnNlZCB0YWJsZS1ob3ZlciB0YWJsZS1zdHJpcGVkIiBpZD0ic2VydGFibGUtaWQiPg0KCQkJCTx0aGVhZD4NCgkJCQkJPHRyPg0KCQkJCQkJPHRoIHN0eWxlPSJ3aWR0aDogMSU7Ij5TYXZlPC90aD4NCgkJCQkJCTx0aCBzdHlsZT0id2lkdGg6IDIwJTsiPkFjY2Vzc2lvbiBudW1iZXI8L3RoPg0KCQkJCQkJPHRoPlBhdGllbnQgbmFtZTwvdGg+DQoJCQkJCQk8dGggc3R5bGU9IndpZHRoOiAyNSU7Ij5QYXRpZW50IGRhdGUgb2YgYmlydGg8L3RoPg0KCQkJCQkJPHRoIHN0eWxlPSJ3aWR0aDogMTUlOyI+U3R1ZHkgZGF0ZTwvdGg+DQoJCQkJCTwvdHI+DQoJCQkJPC90aGVhZD4NCgkJCQk8dGJvZHkgaWQ9InNlcmNocmVzbGlzdCI+IDwvdGJvZHk+DQoJCQk8L3RhYmxlPg0KCQkJPGRpdiBjbGFzcz0icGFuZWwtZm9vdGVyIiBpZD0idXBsb2FkZm9vdGVyLWlkIj5VcGxvYWQ8L2Rpdj4NCgkJCTx0YWJsZSBpZD0iZmlsZXMtdGFiIiBjbGFzcz0idGFibGUgdGFibGUtYm9yZGVyZWQgdGFibGUtc3RyaXBlZCB0YWJsZS1jb25kZW5zZWQiPg0KCQkJCTx0aGVhZD4NCgkJCQkJPHRyPg0KCQkJCQkJPHRoIHN0eWxlPSJ3aWR0aDogMSU7Ij5TZWxlY3Q8L3RoPg0KCQkJCQkJPHRoPkZpbGUgTmFtZTwvdGg+DQoJCQkJCTwvdHI+DQoJCQkJPC90aGVhZD4NCgkJCQk8dGJvZHkgaWQ9ImZpbGVzLWlkIj4NCgkJCQkJPHRyPg0KCQkJCQkJPHRkPg0KCQkJCQkJCTxkaXYgY2xhc3M9ImNoZWNrYm94IHB1bGwtbGVmdCI+DQoJCQkJCQkJCTxsYWJlbD4NCgkJCQkJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgdmFsdWU9InRydWUiPiA8L2xhYmVsPg0KCQkJCQkJCTwvZGl2Pg0KCQkJCQkJPC90ZD4NCgkJCQkJCTx0ZD5NaWNoYWVsPC90ZD4NCgkJCQkJCTx0ZD5ubzwvdGQ+DQoJCQkJCTwvdHI+DQoJCQkJCTx0cj4NCgkJCQkJCTx0ZD4NCgkJCQkJCQk8ZGl2IGNsYXNzPSJjaGVja2JveCBwdWxsLWxlZnQiPg0KCQkJCQkJCQk8bGFiZWw+DQoJCQkJCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIHZhbHVlPSJ0cnVlIj4gPC9sYWJlbD4NCgkJCQkJCQk8L2Rpdj4NCgkJCQkJCTwvdGQ+DQoJCQkJCQk8dGQ+TWljaGFlbDwvdGQ+DQoJCQkJCQk8dGQ+bm88L3RkPg0KCQkJCQk8L3RyPg0KCQkJCQk8dHI+DQoJCQkJCQk8dGQ+DQoJCQkJCQkJPGRpdiBjbGFzcz0iY2hlY2tib3ggcHVsbC1sZWZ0Ij4NCgkJCQkJCQkJPGxhYmVsPg0KCQkJCQkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiB2YWx1ZT0idHJ1ZSI+IDwvbGFiZWw+DQoJCQkJCQkJPC9kaXY+DQoJCQkJCQk8L3RkPg0KCQkJCQkJPHRkPk1pY2hhZWw8L3RkPg0KCQkJCQkJPHRkPm5vPC90ZD4NCgkJCQkJPC90cj4NCgkJCQk8L3Rib2R5Pg0KCQkJPC90YWJsZT4NCgkJCTxkaXYgY2xhc3M9InBhbmVsLWZvb3RlciIgaWQ9ImpvYnNsaXN0Zm9vdGVyLWlkIj5Kb2JzPC9kaXY+DQoJCQk8dWwgaWQ9ImpvYnNsaXN0IiBjbGFzcz0ibGlzdC1ncm91cCI+DQoJCQkJPGxpIGNsYXNzPSJsaXN0LWdyb3VwLWl0ZW0iPkZpcnN0IEl0ZW08L2xpPg0KCQkJCTxsaSBjbGFzcz0ibGlzdC1ncm91cC1pdGVtIj5TZWNvbmQgSXRlbTwvbGk+DQoJCQkJPGxpIGNsYXNzPSJsaXN0LWdyb3VwLWl0ZW0iPlRoaXJkIEl0ZW08L2xpPg0KCQkJPC91bD4NCgkJPC9kaXY+DQoJPC9kaXY+DQo8L2JvZHk+DQoNCjwvaHRtbD4="

type FindData struct {
	FTime    int
	CfindRes []FindRes
	Refresh  bool
}

//main srv class
type DJsServ struct {
	jbBal JobBallancer
	dDisp DDisp
	//echSta EchoRes
	fndTm int
	fRes  []FindRes
}

//start and init srv
func (srv *DJsServ) Start(listenPort int) error {
	srv.jbBal.Init(&srv.dDisp, srv, srv)
	srv.dDisp.dCln.CallerAE_Title = "AE_DTOOLS"
	http.HandleFunc("/c-echo", srv.cEcho)
	http.HandleFunc("/c-find", srv.cFind)
	http.HandleFunc("/c-finddat", srv.cFindData)
	http.HandleFunc("/c-ctore", srv.cStore)
	http.HandleFunc("/index.html", srv.index)
	http.HandleFunc("/chd", srv.chd)
	http.HandleFunc("/jobs", srv.jobs)
	if err := http.ListenAndServe(":"+strconv.Itoa(listenPort), nil); err != nil {
		return errors.New("error: can't start listen http server")
	}
	return nil
}

//serve cEcho responce
func (srv *DJsServ) cEcho(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var dec EchoReq
	if err := json.Unmarshal(bodyData, &dec); err != nil {
		strErr := "error: can't parse DicomCEchoRequest data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}

	ech, err := srv.dDisp.Dispatch(dec)
	if err != nil {
		log.Printf("error: can't push job")
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return

	}

	js, err := json.Marshal(ech)
	if err != nil {
		log.Printf("error: can't serialize servise state")
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return
	}
	rwr.Write(js)
}

//serve cEcho responce
func (srv *DJsServ) cFind(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var fr FindReq
	if err := json.Unmarshal(bodyData, &fr); err != nil {
		strErr := "error: can't parse cFind data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}

	if err := srv.jbBal.PushJob(fr); err != nil {
		log.Printf("error: can't push job")
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return

	}
	//return non error empty data
	rwr.Write([]byte{0})
}

//serve find data responce
func (srv *DJsServ) cFindData(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var lctim int
	if err := json.Unmarshal(bodyData, &lctim); err != nil {
		strErr := "error: can't parse time data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	if lctim != srv.fndTm {
		fdat := FindData{Refresh: true, CfindRes: srv.fRes, FTime: srv.fndTm}
		js, err := json.Marshal(fdat)
		if err != nil {
			log.Printf("error: can't serialize cfind data")
			http.Error(rwr, err.Error(), http.StatusInternalServerError)
			return
		}
		rwr.Write(js)
	} else {
		fdat := FindData{Refresh: false}
		js, err := json.Marshal(fdat)
		if err != nil {
			log.Printf("error: can't serialize cfind data")
			http.Error(rwr, err.Error(), http.StatusInternalServerError)
			return
		}
		rwr.Write(js)
	}

}

//serve main page request
func (srv *DJsServ) index(rwr http.ResponseWriter, req *http.Request) {
	rwr.Header().Set("Content-Type: text/html", "*")

	content, err := ioutil.ReadFile("index.html")
	if err != nil {
		log.Println("warning: start page not found, return included page")
		val, _ := base64.StdEncoding.DecodeString(htmlData)
		rwr.Write(val)
		return
	}
	rwr.Write(content)
}

func (srv *DJsServ) DispatchError(fjb FaJob) error {
	log.Print("info: dispatch error ")
	log.Println(fjb.ErrorData)
	return nil
}

func (srv *DJsServ) DispatchSuccess(cjb CompJob) error {
	log.Printf("info: dispatch success %v", cjb)
	switch result := cjb.ResultData.(type) {
	case []FindRes:
		return srv.onCFindDone(result)
	case CStorReq:
		log.Printf("info: cstore succesuly complete %v", result)
	case CGetReq:
		log.Printf("info: cget succesuly complete %v", result)
	default:
		log.Printf("warning: unexpected job type %v", result)
	}
	return nil
}

func (srv *DJsServ) onCFindDone(fres []FindRes) error {
	srv.fRes = fres
	srv.fndTm = time.Now().Nanosecond()
	return nil
}

func (srv *DJsServ) jobs(rwr http.ResponseWriter, req *http.Request) {
	if jobs, err := srv.jbBal.GetJobsList(); err != nil {
		log.Printf("error: can't get jobs list data")
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
	} else {
		js, err := json.Marshal(jobs)
		if err != nil {
			log.Printf("error: can't serialize jobs list data")
			http.Error(rwr, err.Error(), http.StatusInternalServerError)
			return
		}
		rwr.Write(js)
	}

}
func (srv *DJsServ) chd(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()

	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var chd struct {
		New    string
		CurDir string
	}
	if err := json.Unmarshal(bodyData, &chd); err != nil {
		strErr := "error: can't parse new dir data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}

	dir, ls, err := Lsd(chd.CurDir + string(os.PathSeparator) + chd.New)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
	}
	var rd struct {
		Files  []Finfo
		CurDir string
	}
	rd.CurDir = dir
	rd.Files = ls
	js, err := json.Marshal(rd)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return
	}
	rwr.Write(js)
}

func (srv *DJsServ) cStore(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		strErr := "error: Can't read http body data"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	var cstr CStorReq
	if err := json.Unmarshal(bodyData, &cstr); err != nil {
		strErr := "error: can't parse c-strore date"
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(strErr)
		return
	}
	if err := srv.jbBal.PushJob(cstr); err != nil {
		log.Printf("error: can't push job")
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return

	}
	rwr.Write([]byte{0})
}
